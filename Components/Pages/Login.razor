@page "/login"
@using Digesett.Services
@inject IAgentService AgentService
@inject NavigationManager NavigationManager
@rendermode InteractiveServer

<div class="login-container">
    <div class="login-box">
        <h3>DIGESETT - Acceso de Agentes</h3>
        
        <div class="form-group">
            <label>Cédula:</label>
            <input type="text" @bind="cedula" class="form-control" />
        </div>
        
        <div class="form-group">
            <label>Contraseña:</label>
            <input type="password" @bind="password" class="form-control" />
        </div>
        
        @if (!string.IsNullOrEmpty(errorMessage))
        {
            <div class="alert alert-danger">
                @errorMessage
            </div>
        }
        
        <button class="btn btn-primary" @onclick="HandleLogin">
            Iniciar Sesión
        </button>
    </div>
</div>

@code {
    // Campo que almacena la cédula ingresada por el usuario
    private string cedula = "";

    // Campo que almacena la contraseña ingresada por el usuario
    private string password = "";

    // Campo que almacena el mensaje de error si ocurre algún problema al iniciar sesión
    private string errorMessage = "";

    // Método para manejar el proceso de inicio de sesión
    private async Task HandleLogin()
    {
        try
        {
            // Llamar al servicio de agentes para autenticar al agente con la cédula y contraseña ingresadas
            var agent = await AgentService.LoginAsync(cedula, password);
            
            // Si el agente existe, redirigir al registro de multas
            if (agent != null)
            {
                NavigationManager.NavigateTo("/registro-multa");
            }
            else
            {
                // Si las credenciales son inválidas, mostrar un mensaje de error
                errorMessage = "Credenciales inválidas";
            }
        }
        catch (Exception ex)
        {
            // Manejar cualquier excepción que ocurra durante el proceso de inicio de sesión
            errorMessage = "Error al iniciar sesión";
        }
    }
}